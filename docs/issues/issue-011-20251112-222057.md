# Issue #011: Challenge Mode Always Marks "A" as Correct

**Date:** 2025-11-12 22:20:57  
**Status:** Fixed  
**Priority:** High  
**Type:** Bug

## Description

In Challenge mode, option "A" was always marked as correct, regardless of whether it was actually the correct answer. This occurred even when options were shuffled, causing incorrect validation.

## Root Cause

The answer validation logic in `submitChallengeAnswer()` was comparing `selected.value` (the label like "A", "B", "C", "D") to `question.correctAnswerLabel`. However, `correctAnswerLabel` was not always updated correctly after options were shuffled, or there was a mismatch between the stored label and the actual correct option.

The comparison method was unreliable because:
1. Options are shuffled during question generation
2. The `correctAnswerLabel` should be updated after shuffling
3. Label comparison is fragile and can break if labels aren't synchronized

## Solution

Changed the validation logic to use `dataset.correct` instead of label comparison. The `renderRadioOptions()` function already sets `radio.dataset.correct = option.correct` for each option, so we can directly check if the selected option has `dataset.correct === 'true'`.

### Changes Made

**File:** `app.js`

Replaced all instances of:
```javascript
isCorrect = selected.value === question.correctAnswerLabel;
```

With:
```javascript
// Use dataset.correct for reliable comparison instead of label comparison
isCorrect = selected.dataset.correct === 'true';
```

This change was applied to:
- Relationship questions
- Parallel questions
- Perpendicular questions
- Intercept questions
- Rate of Change questions
- Linear Function questions
- Standard Form questions

## Testing

Created new Playwright test file `tests/ui/challenge-answer-validation.spec.js` to verify:
1. Answers are validated correctly for different question types
2. Option "A" is not always marked as correct
3. Both correct and incorrect answers are properly identified

## Files Modified

- `app.js` - Fixed answer validation logic
- `tests/ui/challenge-answer-validation.spec.js` - New test file

## Related Issues

None

## Notes

The fix uses the `dataset.correct` attribute which is set directly from the option's `correct` property, making it more reliable than label comparison. This ensures that the validation works correctly regardless of option shuffling or label assignment.

