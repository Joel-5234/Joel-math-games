# Issue #011: Challenge Mode Always Marks "A" as Correct

**Date:** 2025-11-12 22:20:57  
**Status:** Fixed  
**Priority:** High  
**Type:** Bug

## Description

In Challenge mode, option "A" was always marked as correct, regardless of whether it was actually the correct answer. This occurred even when options were shuffled, causing incorrect validation.

## Root Cause

The answer validation logic in `submitChallengeAnswer()` was comparing `selected.value` (the label like "A", "B", "C", "D") to `question.correctAnswerLabel`. However, `correctAnswerLabel` was not always updated correctly after options were shuffled, or there was a mismatch between the stored label and the actual correct option.

The comparison method was unreliable because:
1. Options are shuffled during question generation
2. The `correctAnswerLabel` should be updated after shuffling
3. Label comparison is fragile and can break if labels aren't synchronized

## Solution

Changed the validation logic to use `dataset.correct` instead of label comparison. However, the initial fix wasn't sufficient - we needed to ensure that `dataset.correct` is explicitly set as a string and compared correctly.

### Changes Made

**File:** `app.js`

1. **Updated `renderRadioOptions()` function** to explicitly set `dataset.correct` as a string:
```javascript
// Before:
radio.dataset.correct = option.correct;

// After:
// Ensure correct is set as string 'true' or 'false' for reliable comparison
radio.dataset.correct = option.correct === true ? 'true' : 'false';
```

2. **Updated all validation checks** to use explicit string conversion:
```javascript
// Before:
isCorrect = selected.dataset.correct === 'true';

// After:
// Use dataset.correct for reliable comparison - ensure it's explicitly checked as string
isCorrect = String(selected.dataset.correct) === 'true';
```

This ensures that:
- `dataset.correct` is always set as a string ('true' or 'false'), not a boolean
- The comparison uses explicit string conversion for maximum reliability
- Works correctly even if there are any type coercion issues

This change was applied to:
- Relationship questions
- Parallel questions
- Perpendicular questions
- Intercept questions
- Rate of Change questions
- Linear Function questions
- Standard Form questions

## Testing

Created new Playwright test file `tests/ui/challenge-answer-validation.spec.js` to verify:
1. Answers are validated correctly for different question types
2. Option "A" is not always marked as correct
3. Both correct and incorrect answers are properly identified

## Files Modified

- `app.js` - Fixed answer validation logic
- `tests/ui/challenge-answer-validation.spec.js` - New test file

## Related Issues

None

## Notes

The fix uses the `dataset.correct` attribute which is set directly from the option's `correct` property, making it more reliable than label comparison. This ensures that the validation works correctly regardless of option shuffling or label assignment.

